# リーダブルコード

# 第一部　表面上の改善


## 1章

## 2章

## 3章

## 4章　美しさ

### 美しさの3つの原則

1. 読み手が慣れているパターンと一貫性のあるレイアウトを使う
2. 似ているコードは似ているように見せる
3. 関連するコードをまとめてブロックにする

<aside>
💡 美しさは必須！コードを読む事に一番時間を使う！美しさは正義！

</aside>

### 美しくする方法

1. 改行位置を揃える(1行のコードの長さによって改行がかわらないようにする
2. メソッドに処理をまとめる(処理をずらずら描かない)
3. 縦の線を揃える(引数や配列など、値を区切る",”(カンマ)の位置を揃える)
4. 並び順に一貫性を持たせる(formに合わせる、アルファベット順など)
5. グルーピング化して、処理を分ける
6. 間違ったスタイルだとしても、プロジェクトのスタイルに合わせる

## 5章　コメントすべきことを知る

### コメントすべきでないこと

- コードを読めばすぐにわかる事を、いちいち書かない
- コード自体がいけてなければ、コメントで補足ではなく、コード自体を修正する
    
    <aside>
    💡 いいコード　＞　悪いコード+良いコメント
    
    </aside>
    

### コメントすべき事

- 自分の考えを書き出す(whyに近い内容100回繰り返すのは○○だから)
- 定数にコメントをつける(考えと似ているが、その対象が定数になっている、数値にした理由)
- コードの欠陥にコメントをつける
    
    <aside>
    💡 よく使う記法で、今後利用したい内容
    
    ```jsx
    /* 
        TODO:   後で修正する
        FIXME:  既知の不具合がある
        HACK:   あまり綺麗じゃない解決作\
        XXX:    危険！！大きな問題がある！！！
    */
    ```
    
    </aside>
    

### 読み手の立ち画になって考える。

- 質問されそうな事を書く(コードを書きながら質問こないかな？っと考えながら書く)
- 罠を事前にコメントで通知する
- 全体像(ファイル自体や、関数単位)を記載する
- ファイル説明の記入例
    
    <aside>
    💡 ファイル全体を説明するコメントは、ファイルの冒頭に入れることで、そのファイルの目的や機能を明確にするのに役立ちます。以下は、一般的なファイル全体を説明するコメントの記載方法の例です。
    下記の例では、/* ... */の形式を使用して、ファイル全体の説明コメントを囲みました。このコメントブロック内に、ファイル名、ファイルの役割や機能の概要、ファイル内で行われる主な処理などを記載することができます。
    
    このようなファイル全体を説明するコメントを冒頭に追加することで、他の開発者がファイルの役割や目的を理解しやすくなります。
    また、プロジェクトが大規模になると、特定のファイルを迅速に特定し、必要なファイルを見つけるのに役立ちます。コメントは、コードの可読性とメンテナンス性を向上させるための重要なツールです。
    
    ```jsx
    javascript
    Copy code
    */
        ファイル名: routes.js
        説明: Expressアプリケーションのルーティングを定義するファイルです。
        このファイルには、クライアントからのリクエストに対して適切なハンドラ関数を割り当てるルートを定義します。
    */
    
    // ルーティングのためのExpressモジュールをインポートする
    const express = require('express');
    
    // Expressアプリケーションのインスタンスを作成する
    const app = express();
    
    // ルート(/)へのGETリクエストに対するハンドラ関数
    app.get('/', (req, res) => {
        res.send('Hello, World!');
    });
    
    /*
        以下に追加のルートや関数を記述することができます
    */
    
    // サーバーを指定のポートで起動する
    app.listen(3000, () => {
        console.log('サーバーがポート3000で起動しました。');
    });
    
    ```
    
    </aside>
    

## 6章　コメントは正確かつ簡潔に(コメントの書き方)

- コメントは簡潔に記載する
- 曖昧な代名詞をさける(データをキャッシュににいれる、ただし`その`サイズを確認する → データが小さければキャッシュに入れる)
- コードの意図を記載し、歯切れの良い文章にする(結論として何を意図したのか、またどういう動作をするのか、何がリターンされ、どうなるのかを書く)
    
    <aside>
    💡 ❌：　過去クローンしたURLによって優先度を変える　　（結論として、優先度をどうしたいのかが記載されていない）
    ⭕️：　未クローンのURLを優先する　(結論が記載されている)
    
    </aside>
    
- 関数の動作を正確に記述する　(改行を数える関数で、空白行をどうするのかが明確になっている必要がある、\n を数えるなどにすればOK)
- 実例をコメントに残
- 引数にコメントを残す
- 総称した言葉を利用する

<aside>
💡 ❌：　所在地から余白を除去して、Avenue → Ave. に変換する
⭕️：　所在地を正規化する

❌：　クラスには大量のメンバーがいる、速度の観点で別ファイルにもいるが、ここに記載する。ファイル読み込み時にメンバー有無を確認しいなければ、DBから読み込み、いれば、そのままこのファイルから返す。いない場合は、今後のためにDBから取得した情報を、このファイルに記載する
⭕️：　このクラスはDBのキャッシュ層です。

</aside>

## 7章　制御フローを読みやすくする

- 条件式は`左側`に調査対象の式(変数など変化する値)、`右側`に比較対象の式(あまり変化しない)で記述する
※「もし君が18歳以上なら」という感じの自然な言語になるようにする
- if分は肯定型　→　単純な条件　→ 関心を惹いたり、目立つ条件
- 三項演算子は基本利用しない(利用してわかりやすくなる場合のみ利用)
- 関数から早く返す
- ネストは浅くする

## 8章　巨大な指揮を分割する

- 説明変数を用いる
    
    <aside>
    💡 
    ❌：　if line.split(”,”)[0].strip() == “root”
    ⭕️：　username = if line.split(”,”)[0].strip() == “root”
                      username == “root”
    
    </aside>
    
- 要約変数を用いる
    
    <aside>
    💡 
    ❌：　if (reqest.user.id) == [document.owner.id](http://document.owner.id) {処理}
    ⭕️：　user_owns_document = （reqest.user.id == [document.owner.id](http://document.owner.id))
                if (user_owns_document) {処理}
    
    </aside>
    
- 短くすればいいってもんじゃない(カッコつけて短くしても読み手には伝わりづらく、結果スピードバンプになる)
- 条件式を反対から記述する事でより良いコードになることも
- 冗長なコードは、変数に格納して利用する

## 9章　変数とよみやすさ

- 役に立たない一時変数は削除する
    
    ```jsx
    //nowはいらない
    now = datetime.datetime.now();
    root_message.last_view_time = now
    
    //シンプルにする！
    root_message.last_view_time = datetime.datetime.now();
    ```
    
- 中間結果を保持するだけなら削除する
    
    <aside>
    💡 配列内のインデックスを特定する関数のreturnを変数に定義して
    その変数を利用して、配列[indexが記載されてる上記の変数]という記述なら、
    配列内のインデックスを特定する関数ではなく、配列ないから値を削除する関数として、記述する
    
    </aside>
    
- ifやwhileなどの制御フローの無駄な変数は削除する（記述しない）
    
    <aside>
    💡 trueやfalseを判定するので、あえて条件に記載する必要ない
    
    ```jsx
    let result =　true;
    
    while(/*条件*/, && !result) {
    		そもそも条件がtrueの間繰り返されるので、resultで判定する必要ない
    }
    ```
    
    </aside>
    
- 変数のスコープを縮める
    
    <aside>
    💡 グローバル> module > クラス > 関数 > ブロックなど、必要最低限の範囲で定義する
    
    </aside>
    

# 第二部　コードの再構成


## 10章　無関係の怪問題を抽出する

- 関数の高位の目的を達成する為に必要で、下位の目的を達成する為だけのコードを抽出して、別の関数に切り出す
- 切り出した関数はユーティリティコードとして汎用的に利用できる
- 高位の目的から完全に独立できれば、プロジェクト関係なく利用できる
- 独立した関数になれば、テストや、改善が容易になる
- 既存で用意されているが、行けてないコードはラッパー関すで隠す！！
- やりすぎには注意！関数だらけになって余計わかりづらい！

## 11章　一度に一つのことを

- タスクを小さく分解して、一つづつタスクを実行する
    
    <aside>
    💡 関数の高位の目的を達成するために必要な侑、多くのタスクを洗い出し、
    タスクごとに実行するようにコードをを記述していく。
    
    </aside>
    
- 同じ領域のタスクは、領域内でまとめて記述してもOK
- 長いコードにぶつかった場合は以下実施！！
    1. 実行しているタスク書き出す
    2. 領域(段落)に分ける

## 12章　コードに思いを込める

- ロジックを言葉にして説明をする(声に出す)
- 説明した複数のロジックに沿ってコードを記述する
  
## 13章　短いコードを書く

- 全てのコードが正確で、高速で、あらゆる入力を処理できる必要はない。
    
    <aside>
    💡 ・店舗検索システムで、一番近いお店を探す際に、北極や南極からの場合に考慮する事項までをコードの中に詰める必要はない
    ・キャッシュを追加する際も、LAU方式でなくても、単方向だけの実装で必要な要求範囲が満たせれば、コードがシンプルな単方向の実装で問題ない
    
    </aside>
    
- ライブラリーを使う！そのためにたまに眺める
- 全てコードで記載せず、linuxコマンドを活用する

### コードを短く保つ手法

1. 汎用的に利用できるユーティリティを使う
2. 未使用コードや、無用な機能のコードを削除する
3. サブプロジェクトに分ける

## 第14章　テストと読みやすさ

### テストを読みやすくする

他者が安心してテストの追加や変更ができるように、テストコードを読みやすくする必要がある

`大切ではない詳細はユーザーから隠し、大切な詳細は目立つようにする`

1. テストが何をしようとしているか、簡単な言葉にして文字に起こす(だいたい1行で記述できるようになる！この時点ではテストコードの中身はなくてOK)
    
    <aside>
    💡 言葉にする際は、以下をガイドラインにする
    
    **こういう`状況`と`入力`から、こういう`振る舞いと出力`を期待する**
    
    </aside>
    
2. 文字に起こした内容を元に、テストコールの中身を書いていく
3. ヘルパーメソッドを利用する
4. 不要な情報は削除する
5. テストの機能に名前をつける(間違ってもTest1とかにしない)
6. テストの接頭辞は`Test_`をつけるなどしてわかりやすくする

### エラーメッセージを読みやすくする

- ライブラリを活用する
- 役にたつエラーメッセージを自作する

### 適切な入力値を選択する

コードを完全にテストする最も単純な入力値ん組み合わせにする

- 入力値は単純にする
    
    <aside>
    💡 ❌：-98778.8
    ⭕️：-1
    
    </aside>
    
- 大量の値が必要な場合は、コードを書く(手動で記載しない)
- 1機能複数テスト
    
    ```jsx
    ChecScoresBeforeAfter("2, 3, 4", "3, 2, 1");   //ソートテスト
    ChecScoresBeforeAfter("0, 0.1, -10", "0");     //マイナスは削除テスト   
    ChecScoresBeforeAfter("1, -2, 1, -2", "1,1");  //重複は許可
    ChecScoresBeforeAfter("","");　　　　　　　　　　　//空の入力は許可
    ```